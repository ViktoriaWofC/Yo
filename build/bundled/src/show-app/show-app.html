<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">


</head><body><dom-module id="show-app">
  <template>
    <style>
      :host {
        display: block;
		<!--padding-top: 64px;-->
      }
	  	  
	  #head {
		display: block;
        background-color: rgba(250, 112, 62, 1);
		height:80px;
		weight: 100px;
		text-align:center;
		line-height: 80px;
		color:white;
		
      }
	  
	  #inp{
		display: block;
        <!--background-color: rgba(205, 255, 173, 1);-->
		background-color:white;
		height:200px;
		width: 200px;
		text-align:center;
		color:black;
		padding:10px;
		margin: 0 auto;
	  }
	  
	  .block1 { 
		width: 800px; 
		height: 100px;
		background: rgba(205, 255, 173, 1);
		padding: 5px;
		padding-right: 20px; 
		padding-bottom: 30px;
		border: solid 1px black; 
		float: left;
	   }
	   
	   .blockHelp { 
		background: rgba(205, 255, 173, 1);
		border: solid 1px black; 
	   }
	   
	   #launch {
		  position: fixed;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  background: white;
		  line-height: 100px;
		}
	    
		paper-fab.red {
			--paper-fab-background: rgba(230, 0, 38, 1);
			--paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
		  }
		  
		  #body{
			display:none;
		}
		
		paper-toolbar.red {
		--paper-toolbar-background: rgba(250, 112, 62, 1);
		--paper-toolbar-title: {
		  font-weight: bold;
		};
		}
	  
    </style>
	
	<app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>
		
	<div align="center" id="launch">
		
		<div>
		<h4>Please, input your nickname:</h4>
                <paper-input value="{{ nickname }}">
                </paper-input>
                <div class="buttons">
                    <paper-button on-click="startChat">Start chat</paper-button>
                </div>
				</div>
	</div>
	
	
	
	<div id="body">
	
	<paper-toolbar class="red" style="position:fixed; top:0px; left:0px; width:100%">
            <div class="title"> Yo chat </div>
    </paper-toolbar>
	
	<paper-dialog id="errServer" modal="">
				<h4>Error connection to server!</h4>				
                <div class="buttons">
                    Ok
                </div>
    </paper-dialog>
		

	<br>	<br><br>	
	<div align="center">		
	<paper-button raised="" on-click="showMore">Show more</paper-button>
	</div>
	
	
	
	
	<paper-listbox id="listbox">
                <template is="dom-repeat" items="{{ helps }}">
                    
                    <paper-item>
						
                               
                    </paper-item>
                </template>
            </paper-listbox>
			
		<div id="listbox">
</div>		
	   
	<div id="fab">
            <paper-fab icon="add" class="red" style="position:fixed; bottom: 30px; right:24px" on-click="sendYo">
			</paper-fab>
	</div>
	<br><br><br><br>
	
	
	</div>
  
	
  </template>

  <script>function hide(e){e.style.display="none",document.getElementById("body").style.display="block",this.startChat()}function getFormattedDate(e){var t=e.getFullYear(),o=(1+e.getMonth()).toString();o=o.length>1?o:"0"+o;var n=e.getDate().toString();return(n=n.length>1?n:"0"+n)+"."+o+"."+t+" /  "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function updateList(e){var t=open.result,o=t.transaction("MyObjectStore","readwrite"),n=o.objectStore("MyObjectStore");console.log("message.key: "+e.key),n.put({key:e.key,text:e.text,nickname:e.nickname,date:e.date}),helps.push(e),helps.sort(function(e,t){return e.key-t.key}),k=helps[0].key,console.log("key: "+k);var s=(helps[helps.length-1],document.getElementById("listbox"));s.innerHTML="";for(var r=0;r<helps.length;r++)s.innerHTML=s.innerHTML+"<br><div style='padding:10px;border:solid 1px black;'>"+helps[r].text+"<br><div style='font-sizesize:2; color:gray;'>"+helps[r].nickname+" : "+helps[r].date+"</div></div>"}function updateViewList(){helps.sort(function(e,t){return e.key-t.key}),k=helps[0].key,console.log("key: "+k);var e=document.getElementById("listbox");e.innerHTML="";for(var t=0;t<helps.length;t++)e.innerHTML=e.innerHTML+"<br><div style='padding:10px;border:solid 1px black;'>"+helps[t].text+"<br><div style='font-sizesize:2; color:gray;'>"+helps[t].nickname+" : "+helps[t].date+"</div></div>"}Polymer({is:"show-app",properties:{nickname:{type:String,value:""},k:{type:Number,value:-1},listYos:{type:Array,value:[]}},resdy:function(){this.$.addNickname.open()},goLink:function(e){this.route="chat"},sendYo:function(){console.log("send Yo");var e=getFormattedDate(new Date);console.log("data: "+e),console.log("nickname: "+this.nickname);var t={};t.text="Yo!",t.date=e,t.nickname=this.nickname,socket.send(JSON.stringify(t)),window.scrollTo(0,document.body.scrollHeight)},showMore:function(){document.getElementById("listbox");console.log("-----------------------------------");var e=k+"";socket.send(e)},startChat:function(e){document.getElementById("launch").style.display="none",document.getElementById("body").style.display="block",0==this.nickname.localeCompare("")&&(this.nickname="Anonimus"),updateViewList(),window.scrollTo(0,document.body.scrollHeight)},updateList:function(e){this.listYos.push(e)},printDB:function(){var e=open.result,t=e.transaction("MyObjectStore","readwrite"),o=t.objectStore("MyObjectStore"),n=o.index("key");console.log("---DB---"),n.openCursor().onsuccess=function(e){if(cursor=e.target.result,cursor){var t={key:cursor.value.key,text:cursor.value.text,date:cursor.value.date,nickname:cursor.value.nickname};console.log("cursor: "+t.key+" "+t.date+" "+t.nickname),cursor.continue()}}}});var k=-1,helps=[],adr="ws://92a9e92f.ngrok.io:80",socket=new WebSocket(adr);socket.onopen=function(){console.log("---open connect---")},socket.onclose=function(e){e.wasClean||(console.log("---close connect---"),socket=new WebSocket(adr))},socket.onmessage=function(e){var t=JSON.parse(e.data);console.log("mess: "+t.date+" "+t.nickname+" "+t.key),updateList(t)},socket.onerror=function(e){};var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,open=indexedDB.open("Data6yp",1);open.onupgradeneeded=function(){var e=open.result,t=e.createObjectStore("MyObjectStore",{keyPath:"key"});t.createIndex("key","key")},open.onsuccess=function(){var e=open.result,t=e.transaction("MyObjectStore","readwrite"),o=t.objectStore("MyObjectStore"),n=o.index("key");getFormattedDate(new Date);n.openCursor().onsuccess=function(e){if(cursor=e.target.result,cursor){var t={key:cursor.value.key,text:cursor.value.text,date:cursor.value.date,nickname:cursor.value.nickname};helps.push(t),console.log("cursor: "+cursor.value.key+" "+cursor.value.date+" "+cursor.value.nickname),cursor.continue()}else console.log("-")}};</script>
</dom-module>
</body></html>